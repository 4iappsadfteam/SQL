
CREATE OR REPLACE FUNCTION IS_AOUNTLESS   (P_OFF_HEADER_ID    NUMBER,
                                           P_PRICE_LIST    NUMBER,
                                           P_UNIT_ID          NUMBER)
		 RETURN VARCHAR2 AS

L_OFFER_MINI_PRICES NUMBER;
L_PL_MINI_PRICES 	NUMBER ;
L_OFFER_QTY 		NUMBER;
L_MINIAMT	 		NUMBER;
L_OFF_AMT           NUMBER;
L_RESULT			VARCHAR2(30):='NULL';

BEGIN
BEGIN 
SELECT
    MIN_PRICE INTO L_OFFER_MINI_PRICES
FROM
    XXPM_OFFER_DETAIL
WHERE
    1=1
AND OFFER_HDR_ID = 2328;
EXCEPTION 
WHEN OTHERS THEN
L_OFFER_MINI_PRICES:=0;
END;

BEGIN
SELECT
    MIN_PRICE INTO L_PL_MINI_PRICES
FROM
    XXPM_PL_LINES
WHERE
    1 = 1
AND PL_ID = 1000297
AND UNIT_ID = 1000272;
EXCEPTION 
WHEN OTHERS THEN
L_PL_MINI_PRICES:=0;
END;

BEGIN
SELECT
    QUANTITY INTO L_OFFER_QTY
FROM
    XXPM_OFFER_DETAIL
WHERE
    1=1
AND OFFER_HDR_ID = 2328;
EXCEPTION 
WHEN OTHERS THEN
L_OFFER_QTY:=0;
END;

BEGIN
SELECT  ((NVL(OFFER_AMOUNT,0)) - (NVL(DISC_AMOUNT,0))) INTO L_OFF_AMT
FROM XXPM_OFFER_DETAIL
WHERE OFFER_HDR_ID=2328;
EXCEPTION 
WHEN OTHERS THEN
L_OFF_AMT:=0;
END;

IF(L_OFFER_MINI_PRICES=0) THEN
 L_MINIAMT := L_PL_MINI_PRICES*L_OFFER_QTY;
ELSE
 L_MINIAMT := L_OFFER_MINI_PRICES;
END IF;

IF L_OFF_AMT>=L_MINIAMT THEN
L_RESULT :='YES';
ELSE
L_RESULT :='NO';
END IF;

RETURN L_RESULT;

END;

